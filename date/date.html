<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Document</title>
   <script src="https://cdn.tailwindcss.com"></script>

   <style>
      .success {
         color: green;
      }

      .userInput{
         background-color: aquamarine;
         margin-bottom:10px;
      }

      .result{
         background-color: yellow;

      }
   </style>
</head>
<body>
   
   <section>

      <div class="container mx-auto p-4 text-center">
         <p>This program was built with Javascript for the programming exercise. Submitted by Gary Mosqueda</p>
         <div class="flex items-center justify-center pt-20">
            <input type="text" class="px-6 py-2 rounded-lg border border-violet-900 w-1/2" id="birth" placeholder="Personâ€™s Name, Birth Date(mm-dd-yyyy)">
            <button class="hover:bg-violet-600 px-6 py-2 bg-violet-900 rounded-lg mx-2 text-white" id="btn">submit</button>
         </div>

         <div class="flex flex-col items-center justify-center space-y-4 pt-3">

            <div class="userInput">

            </div>
            <div class="result">
         
            </div>
            <div class="message">
         
            </div>

         </div>
        
      </div>
     
   </section>
   

   


   <script type="text/javascript">

   
      const btn = document.querySelector("#btn");
      const data = document.querySelector("#birth");
      const message = document.querySelector(".message");
      const userInput = document.querySelector(".userInput");
      const renderResult = document.querySelector(".result");
      const rat= ['1948','1960','1972','1984','1996','2008','2020'];
      const ox=['1949','1961','1973','1985','1997','2009'];
      const tiger = ['1950','1962','1974','1986','1998','2010','2022'];
      const rabbit = ['1951','1963','1975','1987','1999','2011'];
      const dragon = ['1952','1964','1976','1988','2000','2012'];
      const snake = ['1953','1965','1976','1989','2001','2013'];
      const horse =['1954','1966','1977','1990','2002','2014'];
      const goat =['1955','1967','1978','1991','2003','2015'];
      const monkey =['1956','1968','1979','1992','2004','2016'];
      const rooster = ['1957','1969','1980','1993','2005','2017'];
      const dog = ['1958','1970','1981','1994','2006','2018'];
      const pig =['1959','1971','1982','1995','2007','2019'];
      const input = [];
      const validated=[];

      btn.addEventListener("click", function(e){
         e.preventDefault();

      


         if(data.value ==='*'){
            location.reload();
         }

        

         if(data.value.length > 0 ){
            const name = data.value.split(",");
            // input.push(name);

            const year = name[1].split("-");
            
            console.log(year.length);

            const age=checkAge(year[0],year[2]);
            const zodiac = checkZodiac(year[2]);

            let info = {year: year[2],name: name[0],yearBirth: name[1],age: age,zodiac: zodiac};
            let user = {name: name[0],yearBirth:name[1]};

            validated.push(info);
            input.push(user);

            data.value="";

            message.innerHTML = "<h3 class='success'>saving data...<h3>";

            setTimeout(() => {  
               document.querySelector(".success").remove();
            }, 1000);

         } 
         
         else if(data.value.length === 0 ) {
            document.querySelector("#birth").disabled = true;
            document.querySelector("#btn").disabled = true;
            document.querySelector("#btn").innerText ="processing...";
            showResult();

            message.innerHTML = "<h3 class='success'>fetching data...<h3>";

            setTimeout(() => {  
               document.querySelector(".success").remove();
            }, 1000);
         }

      });


      function showResult(){
         let text = "";
         const sorted = validated.sort((a, b) => b.year.localeCompare(a.year))

         let itemsUser = "";
         for (row of input) {
            // console.log(row.year);
            itemsUser += "<li>" + row.name +","+row.yearBirth+ "</li>";
            }


            userInput.innerHTML = itemsUser;

       

         let itemsResults = "";
         for (row of sorted) {
            // console.log(row.year);
            itemsResults += "<li>" + row.name +","+row.yearBirth+","+row.age+","+row.zodiac+ "</li>";
            }


            renderResult.innerHTML = itemsResults;

         // Object.entries(sorted).forEach(([key, value]) => {
         //    // console.log(key, value) // "someKey" "some value", "hello" "world", "js javascript foreach object"

         //    renderResult.innerHTML = "<h3 class='success'>"+ value +"<h3>";
         //    });
     
         // Object.keys(sorted).forEach(key => {
         //    // console.log(key, obj[key]);

         //    renderResult.innerHTML = "<h3 class='success'>"+ sorted[key] +"<h3>";
         
         //    });

      }


      function checkZodiac(year){
         let reZodiac='';

         function check(zodiac) {
                     
                     return zodiac == year;
                     
                  }


         const isRat = rat.filter(check);        
         if(isRat.length !==0){
            reZodiac = 'rat';
         }


         const isOx = ox.filter(check);
            if(isOx.length !==0){
            reZodiac = 'Ox';
         }

         const isTiger = tiger.filter(check);
         if(isTiger.length !==0){
         reZodiac = 'Tiger';
         }


         const isRabbit = rabbit.filter(check);
         if(isRabbit.length !==0){
         reZodiac = 'Rabbit';
         }


         const isDragon = dragon.filter(check);
         if(isDragon.length !==0){
         reZodiac = 'Dragon';
         }


         const isSnake = snake.filter(check);
         if(isSnake.length !==0){
         reZodiac = 'Snake';
         }

         const isHorse = horse.filter(check);
         if(isHorse.length !==0){
         reZodiac = 'Horse';
         }

         const isGoat = goat.filter(check);
         if(isGoat.length !==0){
         reZodiac = 'Goat';
         }


         const isMonkey = monkey.filter(check);
         if(isMonkey.length !==0){
         reZodiac = 'Monkey';
         }


         const isRooster = rooster.filter(check);
         if(isRooster.length !==0){
         reZodiac = 'Rooster';
         }


         const isDog = dog.filter(check);
         if(isDog.length !==0){
         reZodiac = 'Dog';
         }


         const isPig = pig.filter(check);
         if(isPig.length !==0){
         reZodiac = 'Pig';
         }

       return reZodiac;
      }



      function checkAge(month,year){
         currentMonth=8;
         currentYear=2022;

         if(month < currentMonth){
            age = currentYear-year;
         } else{
            age= (currentYear-year) -1;
         }
         return age;

      }


     



   </script>
</body>
</html>